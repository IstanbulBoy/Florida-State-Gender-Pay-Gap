---
title: "Is there a Gender Pay Gap in the Florida's Government?"
output:
  pdf_document: default
  html_document:
    theme: journal
---

## A quick analysis of Florida's State Payroll
### Charles McGuinness, charles@mcguinness.us
### `r format(Sys.time(), "%B %d, %Y")`

```{r setup, echo=FALSE, message=FALSE}
source('getNamesSimple.R')
getNamesSimple()
source('Salaries.R')
getSalaries()
library(pander)
panderOptions('table.split.table', Inf)
```

# Introduction

Is there is a persistent bias in the wages paid to male vs. female workers in the USA? 
According to the [Bureau of Labor Statistics](http://www.bls.gov/cps/wlf-databook-2011.pdf),
women in America make, on average, 81 cents for every dollar a man makes.  Is this
a result of discrimination against women, or are there benign and innocent
causes?
Many
[reasons for the gap](http://en.wikipedia.org/wiki/Male%E2%80%93female_income_disparity_in_the_United_States#Sources_of_the_gender_gap)
have been suggested, some of which are related to the different choice of careers made by men and women,
and some reasons which are attributed to outright discrimination.

Part of the challenge of understanding the root causes of pay gap is that it's 
hard to get good, detailed data on jobs and pay.
Researchers often rely on [surveys](http://psidonline.isr.umich.edu/) to discern
trends and deduce reasons.  But the
use of incomplete data leads to interpretation and opens the door to the subjective bias of the researcher.

The state of Florida offers us an opportunity to do a more objective analysis, as it provides a complete, downloadable 
database of its payroll as part of the open government program. By looking at this data, we can examine the 
dimensions of pay differences in the Florida state government, and start to answer the question of whether Florida has a gender pay gap.
I write "start", because a a better answer to the question requires far more research and analysis than I (and maybe anyone)
am capable of. However, we can at least see if there is prima facie evidence of bias and start to see the dimensions of the issue.

\newpage

# Bias Across Entire Workforce

The first way to look at the data is at men and women across the board.  Let's look at the pay for salaried, full time employees.

```{r histogram, echo=FALSE, cache=TRUE}
coreSalaries <- salaries[(salaries$Full.Part.Time=="Full Time") & (salaries$Employee.Type == "Salaried"),]
par(mfrow=c(1,2))
hist(coreSalaries$nSalary[coreSalaries$gender=="M"], xlim = c(0,200000), breaks=30, ylim=c(0,20000), main="Male Employees", xlab="Salary")
hist(coreSalaries$nSalary[coreSalaries$gender=="F"], xlim = c(0,200000), breaks=30, ylim=c(0,20000), main="Female Employees", xlab="Salary")
```

The chart shows that female pay rates are lower than male's, in general. Let's do some elementary stats to quantify that:

```{r quick_stats, echo=FALSE, cache=TRUE}
pander(data.frame(Male_mean = mean(coreSalaries$nSalary[coreSalaries$gender=="M"]),
           Male_median = median(coreSalaries$nSalary[coreSalaries$gender=="M"]),
           Female_mean = mean(coreSalaries$nSalary[coreSalaries$gender=="F"]),
           Female_median = median(coreSalaries$nSalary[coreSalaries$gender=="F"])))
```

What this tells us is that the average female pay is 
$`r round(mean(coreSalaries$nSalary[coreSalaries$gender=="M"])-mean(coreSalaries$nSalary[coreSalaries$gender=="F"]), digits=0)` 
lower than the average male's. Stated differently, the average woman makes 
`r round(100*mean(coreSalaries$nSalary[coreSalaries$gender=="F"])/mean(coreSalaries$nSalary[coreSalaries$gender=="M"]), digits=0)`
cents for every dollar the average man makes.

This number is fairly consistent with other estimates of the [US gender pay gap](http://en.wikipedia.org/wiki/Gender_pay_gap#United_States)
(although quite a bit better).  According to [this report](http://www.aauw.org/files/2014/09/Florida-Pay-Gap-2014.pdf),
the median (not mean) earnings for men in Florida is $41K compared to women's $34K.  The median pay at the state of Florida has a narrower gap,
but generally reflects the same trends as we see in the private sector in Florida as well.

This disparity is not proof of bias, of course.  Just the different types of jobs, seniority, and training the different sexes
have can account for the differences.  The gold standard for detecting bias is whether men and women are paid differently
all other relevant things being equal.  (What is relevant is, of course, another contentious topic.)

\newpage

# Bias Within Job Classes

```{r detailed1,echo=FALSE, cache=TRUE}
source('salaryOperations.R')
sbc <- salaryByClass(coreSalaries)
```

The data from Florida also includes a job classification,
with `r length(sbc$titles)` different job titles in the data.
Example job classifications include:

* SAFETY PROGRAM MANAGER - SES
* REGIONAL OPERATIONS MANAGER
* HUMAN RESOURCE TECHNICIAN II
* DIRECTOR OF STAFF & CURR. DEVELOPMENT
* GOVERNOR

(Interestingly, the Governor is the lowest paid full time salaried employee in Florida, getting $0.12 per year)

The use of titles provides us a better way of looking at the data.  Now we can ask
whether on average, within each job classification, women are paid less than the men in that same classification.

To do this, I compute the average pay in each job classification (across men, women, and folks I cannot assign a sex to).
Then I divide each man's pay and each woman's pay by the average pay in that classification.  We can call this the
"normalized" salary. A normalized salary below 1 indicates
the person is getting paid less than average.  Conversely, a number above indicates the person is getting paid more than
average.

Here is a histogram of the normalized salaries for men and women: it shows, in a glance, what they're getting paid:

```{r detailed2,echo=FALSE, cache=TRUE}
bias <- computeBias(sbc)
```
```{r detailed3,echo=FALSE, cache=TRUE}
par(mfrow=c(1,2))
hist(bias$Mens*100,main="Male Employees",  breaks=30, xlab="% of average in class")
hist(bias$Womens*100,main="Female Employees", breaks=30, xlab="% of average in class")
```

If we  average all the men's normalized salary and all the of the women's normalized salary, this gives us a view
of how the average male and female employee of the State of Florida is doing.
In a perfect, bias free world, the average man's and woman's pay would be 1.0.

In Florida, the numbers are:

```{r detailedstats,echo=FALSE, cache=TRUE}
pander(
  data.frame(Mens.Mean=mean(bias$Mens), 
#           Mens.Median=median(bias$Mens),
           Mens.stddev=sd(bias$Mens), 
           Womens.Mean=mean(bias$Womens),
#           Womens.Median=median(bias$Womens),
           Womens.stddev=sd(bias$Womens))
)
```

By looking at this data, we can see that, for job classifications that have both male and female employees,
the female employees on average receive `r round(100*mean(bias$Womens)/mean(bias$Mens),digits=0)` cents for every $1
a male makes -- virtually indistinguishable. The "stddev" is the standard deviation, and this table shows us that
women's salaries fall in a bit more of a narrow range than menâ€™s do.


# Bias Within Similar Job Classes

Even if the pay within job classes was unbiased, there could still be a 
source of bias if women are not promoted as frequently through the levels
as men are.  That would result in women being paid less for the
same job by being
slotted into lower paying levels.

Here is an example of titles with levels in the payroll database:

* GOVERNMENT OPERATIONS CONSULTANT I
* GOVERNMENT OPERATIONS CONSULTANT II
* GOVERNMENT OPERATIONS CONSULTANT III

You could imagine that, if there were pay bias, women would be disproportionately
assigned to the level I jobs while men were over-represented in the level III jobs.

An easy way to check is to take the average pay for all levels (in this example,
anyone with a "GOVERNMENT OPERATIONS CONSULTANT" job regardless of level),
and see if, out of these larger pools, women were paid less than men.

```{r commondetailed1,echo=FALSE, cache=TRUE}
source('titleShrink.R')
commonTitles <- titleShrink(coreSalaries)
sbc <- salaryByClass(commonTitles)
```
Let's run the same analysis, but this time consider all I, II, III, etc. jobs to
be the same basic job.  Is there a bias to be found because women are in lower levels?

Here is the distribution of normalized salaries for men and women, when the
normalization is done against the average for all levels of a title:

```{r commondetailed2,echo=FALSE, cache=TRUE}
bias <- computeBias(sbc)
par(mfrow=c(1,2))
hist(bias$Mens*100,main="Male Employees",  breaks=30, xlab="% of average in similar classes")
hist(bias$Womens*100,main="Female Employees", breaks=30, xlab="% of average in similar classes")
```

The histogram doesn't give us an obvious answer, but by looking across all men
and women we can get a better answer.
For job classifications that have both male and female employees,
the female employees on average receive 
`r round(100*mean(bias$Womens)/mean(bias$Mens),digits=0)` cents for every $1
a male makes --which make the pay virtually indistinguishable.

The full statistics are:

```{r commontitlestats,echo=FALSE, cache=TRUE}
pander(
data.frame(Mens.Average=mean(bias$Mens), 
           Mens.stddev=sd(bias$Mens), 
           Womens.Average=mean(bias$Womens), 
           Womens.stddev=sd(bias$Womens))
)
```

\newpage

# Bias Between Heavily Male and Female Job Categories

We see that men and women are generally paid the same within job classifications.
And yet there's an overall pay gap between male and female state employees.  So
that brings us to the logical conclusion: that job classifications that have
more female employees tend to be paid worse than those that have more men.

Looking at all job classifications that are at least 2/3rds male or at least 2/3rds
female, we can see the following:

```{r classBias0,echo=FALSE, cache=TRUE}
classBias <- computeLopsided(sbc)
```
```{r classBias1,echo=FALSE, cache=TRUE}
par(mfrow=c(1,2))
hist(classBias$Mens,main="\"Men's Jobs\"", xlim = c(0,200000), ylim=c(0,20000), breaks=30, xlab="Salary")
hist(classBias$Womens,main="\"Women's Jobs\"",xlim = c(0,200000),ylim=c(0,20000), breaks=30, xlab="Salary")
```

We can see that there's a strong bias between male dominated and female dominated
job classifications.  The average pay for each sex is:

```{r classBias2,echo=FALSE, cache=TRUE, message=FALSE}
pander(
data.frame(Mens.Average=mean(classBias$Mens), 
           Mens.stddev=sd(classBias$Mens), 
           Womens.Average=mean(classBias$Womens), 
           Womens.stddev=sd(classBias$Womens))
)
```

So when you compare jobs that are heavily female versus jobs that are heavily male,
we see that women earn `r round(100*mean(classBias$Womens)/mean(classBias$Mens), 0)`
cents for every dollar a man earns.

\newpage

What are the most heavily male and heavily female job categories?

```{r topcats, echo=FALSE, message=FALSE}
pander(
data.frame(Top_Womens=head(lopsided.titles[order(-lopsided.balance)], n=10),
           Top_Mens=head(lopsided.titles[order(lopsided.balance)], n=10)),
justify=c("left", "left")
)
```

It seems that much of the discrepency can be attributed to the heavily
male presence in law enforcement jobs.  This appears to be an example of the
[danger wage premium](http://en.wikipedia.org/wiki/Male%E2%80%93female_income_disparity_in_the_United_States#Danger_wage_premium)
concept, even if that concept is not settled fact.

\newpage

# Conclusions

As with most other studies of the gender pay gap, looking at the state of Florida's
payroll leaves us with many questions even if we have a better understanding
of the situation.

* We have seen that across all state employees, women receive
`r round(100*mean(coreSalaries$nSalary[coreSalaries$gender=="F"])/mean(coreSalaries$nSalary[coreSalaries$gender=="M"]), digits=0)` cents
to every $1  male employees make.
* But when we look within various job classifications, however, we see that
there is broad parity in the pay men and women receive for doing the same
job.  
* And so when we break job classifications into those that are
predominantly female vs. predominantly male, we see the gender pay gap open
its widest: "men's work" pays substantially better than "women's work",
with women only earning
`r round(100*mean(classBias$Womens)/mean(classBias$Mens), 0)` cents
for every dollar the men make.  This could be a result of completely
legitimate reasons (the danger wage premium mentioned above), or it
could be for illegitimate reasons (e.g., law enforcement is better able
to bargain/lobby for higher pay).

Certainly, the State of
Florida appears to be doing a good job of ensuring that men and women doing the
same work are getting paid the same.  But the data also suggest that
the state should look carefully at pay differences between traditionally
male and female jobs to see if and where women are being underpaid even
though they bring comparable levels of skill, training, and experience
to the job.

\newpage

# Appendix

## Methodology

The State of Florida provide weekly salary updates on its [official site](http://dmssalaries.herokuapp.com/salaries). There, you
can download the complete payroll ("Export All Salaries").  This report starts with this data and then enriches it to prepare
for the analysis.

The enrichment takes two steps:

1. Some simple clean up of the data (trivial)
2. Estimating the gender of each employee (non-trivial)

With the enriched data, this report looks at gender differences across the entire state, as well as differences within each 
job classification.  For the purposes of this analysis, only employees who are full-time and salaried were 
looked at (a vast majority of state employees), to order to avoid distortions caused by part-time work or the variable
pay earned by hourly workers (because of differences in hours worked).

## Estimating Gender

Since the question at hand is the pay differences for men and women, a key piece of information is knowing which employees are
male and which are female.  That information, however, is not present in the data downloaded from the state.
Thus, the first step of the analysis is to estimate the gender of each employee from their first name.

The actual mapping of first names to gender is a fairly straight-forward process, driven by a database of names.
The source of this database is a Social Security Administration published list of the 1000 most popular baby names from each
year.  By downloading this data and aggregating it across the years,
one can build up with a very comprehensive list of names and the sexes of those names. 

For this analysis, names from 1945 to 2013 were used, giving a database with the following # of unique names:

```{r loadNames, echo=FALSE, message=FALSE}
pander(data.frame(Total_Male_Names = sum(firstNames$males > 0), Total_Female_Names = sum(firstNames$females > 0)))
```

The list of names requires a bit of processing, as it turns out that many first names have been given to both male and
female babies.  Usually, there is such an overwhelming trend in the use that the name is unambiguously male or female.
For example, for Charles, my name, the counts of male vs. female babies:

```{r charles_example, echo=FALSE}
  pos <- match("charles", firstNames$names)
  pander(data.frame(Male_Charles = firstNames$males[pos], Female_Charles = firstNames$females[pos]))
```

That's pretty definitive.  But for other names, like "Pat", not so much:

```{r pat_example, echo=FALSE}
  pos <- match("pat", firstNames$names)
  pander(data.frame(Male_Pat = firstNames$males[pos], Female_Pat = firstNames$females[pos]))
```

For this analysis, I have used a rule that 90% or more of the babies with a given name have to be male (or female)
to decide the name is unambiguously male or female.
There's a little room for error (at worst, a 10% chance of mis-identification), but that's going to affect only a very
small number of names on the edge.  But if a name falls below 90% male or female, I declare it to be androgynous (like
"Pat" is).
If the database doesn't have the name, I try a few simple transformations to find it.  For example, sometimes the first
name field in the employee data has both the first and middle name in it; so when I find a compound name I test each
component of it.  "Mary Grace" may not be in the database, but "Mary" is.

There are some names that remain where we just don't know.  Lots of initials are in the database.  Other names are very rare
or have spelling variations not recognized. Fortunately, the vast majority of employees can be
assigned a gender.  Here are the final counts:

```{r salaries_gender, echo=FALSE}
pander(
  data.frame(Males = sum(salaries$gender=="M"), 
           Females = sum(salaries$gender=="F"), 
           Androgenous = sum(salaries$gender=="A"), 
           Unknown = sum(salaries$gender=="U"))
  )
```

We could loosen the 90% restriction (perhaps to 80%) to move a few more androgynous names into definitive ones, but I do not think
the trade-off is beneficial

### Fork me!

This work is licensed under a [Creative Commons Attribution 4.0 International License](http://creativecommons.org/licenses/by/4.0/).

Like this? Don't like this? Think you can do better? By all means!
You can download, run, and modify the complete sources for this analysis on
[Github](https://github.com/cmcguinness/Florida-State-Gender-Pay-Gap).
See if I've made any mistakes, or if you can improve my analysis.
